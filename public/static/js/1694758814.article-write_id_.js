import{a0 as e,C as l,v as a,r as t,R as s,h as o,P as i,u as n,p as r,m as c,i as u,S as d,a as m,J as p,o as v,c as g,b as f,K as b,e as h,d as y,a1 as w,w as V,k as x,T as k,U as _,F as j,g as z,f as A,j as U,t as T,l as C,W as L}from"./1694758814.index.js";import{_ as I,a as S}from"./1694758814.i-tinymce.js";const E={class:"container-fluid container-box px-1 px-lg-0"},R={class:"row"},H={class:"col-lg-9"},$={class:"card mb-2"},M={class:"card-body custom",style:{"min-height":"485px"}},N={class:"card-footer"},O={class:"col-lg-3 custom",id:"page-header-title"},q={class:"card mb-2"},G={class:"card-body px-2 py-0"},J={class:"form-group mb-3"},K=f("span",{class:"ms-1 required"},"标题：",-1),B={key:0,class:"form-group mb-3"},D={class:"form-label"},F=f("span",{class:"ms-1"},"审核状态：",-1),P={class:"font-13"},W={class:"text-muted float-end"},Q={class:"form-group mb-3"},X=f("span",{class:"ms-1"},"摘要：",-1),Y={class:"card mb-2"},Z={class:"card-body px-2 py-0"},ee={class:"card mb-2"},le={class:"card-body px-2 py-0"},ae={class:"form-group mb-3"},te={class:"form-label"},se=f("span",{class:"ms-1"},"置顶：",-1),oe={class:"form-group mb-3"},ie={class:"form-label"},ne=f("span",{class:"ms-1"},"分类：",-1),re={class:"form-group"},ce={class:"form-label"},ue=f("span",{class:"ms-1"},"标签：",-1),de={class:"card"},me={class:"card-body px-2 py-0"},pe={class:"form-group mb-3"},ve={class:"form-label"},ge=f("span",{class:"ms-1"},"允许评论：",-1),fe={class:"font-13"},be={class:"text-muted float-end"},he={class:"form-group mb-3"},ye={class:"form-label"},we=f("span",{class:"ms-1"},"显示评论：",-1),Ve={class:"font-13"},xe={class:"text-muted float-end"},ke={class:"inis-save"},_e={__name:"article-write[id]",setup(_e){const{ctx:je,proxy:ze}=z(),Ae=e(),Ue=l(),Te=a(),Ce=t({item:{id:null,tags:[],group:[],active:["1"],menu:{...s,menuList:[{label:"保存",icon:'<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="12" height="12">\n                    <path fill="rgb(var(--menu-icon-color))" d="M777.216 0a106.496 106.496 0 0 1 77.824 48.128A107.52 107.52 0 0 1 870.4 102.4v153.6h68.096a102.4 102.4 0 0 1 73.216 51.2 120.832 120.832 0 0 1 12.288 39.936v583.68a113.664 113.664 0 0 1-26.112 56.832 106.496 106.496 0 0 1-65.536 34.304H91.136a113.152 113.152 0 0 1-55.808-25.088A106.496 106.496 0 0 1 0 932.352V349.184a112.64 112.64 0 0 1 15.36-45.056A102.4 102.4 0 0 1 92.16 256H153.6V153.6 88.576a96.256 96.256 0 0 1 20.48-51.2A104.96 104.96 0 0 1 247.296 0z m140.288 540.16H83.456v370.688a35.84 35.84 0 0 0 0 17.92 24.576 24.576 0 0 0 13.824 10.752 17.408 17.408 0 0 0 10.24 0h816.64a21.504 21.504 0 0 0 17.92-24.576v-374.784a51.2 51.2 0 0 0-24.576 0z m-204.8 48.64a40.448 40.448 0 0 1 37.888 39.936 44.544 44.544 0 0 1-17.408 34.816l-256 220.16a41.984 41.984 0 0 1-44.032 6.656A72.192 72.192 0 0 1 409.6 870.4l-115.2-132.608a41.984 41.984 0 0 1-13.312-29.184 38.912 38.912 0 0 1 26.112-38.912 39.936 39.936 0 0 1 47.104 10.24c34.304 37.888 67.584 77.312 102.4 115.2 76.288-65.024 153.6-131.072 227.84-196.608a40.96 40.96 0 0 1 28.16-9.728zM870.4 337.92V460.8a98.304 98.304 0 0 0 34.816 2.56 90.624 90.624 0 0 0 35.328-2.56V370.688a70.144 70.144 0 0 0 0-17.92 21.504 21.504 0 0 0-15.36-14.848c-7.68-5.12-17.92 0-26.624 0s-18.432-4.608-28.16 0zM102.4 338.432a19.968 19.968 0 0 0-20.48 19.968v102.4a32.768 32.768 0 0 0 20.48 2.56h54.784V363.52a51.2 51.2 0 0 0 0-23.04c-20.992-2.56-38.912-3.072-54.784-2.048z m665.6-256H260.096a21.504 21.504 0 0 0-24.064 16.384c-3.072 2.56-2.56 6.656-3.072 10.24v325.12A59.392 59.392 0 0 0 235.52 460.8a28.16 28.16 0 0 0 8.704 2.56h512a69.12 69.12 0 0 0 30.72-2.56 28.16 28.16 0 0 0 0-8.704V108.544a17.92 17.92 0 0 0 0-10.24 22.528 22.528 0 0 0-23.04-16.384zM358.4 204.8h112.64a41.472 41.472 0 0 1 39.424 30.208 39.936 39.936 0 0 1-10.752 39.424 42.496 42.496 0 0 1-30.72 12.288H354.304a58.88 58.88 0 0 1-23.04-3.584 40.448 40.448 0 0 1-24.064-39.424 39.936 39.936 0 0 1 33.28-38.912A82.944 82.944 0 0 1 358.4 204.8z"></path>\n                </svg>',fn:()=>Le.save()}]},tabs:"preview",cover:{preview:[],links:""},loading:!1,wait:!1},struct:{content:"",editor:null,json:{comment:{allow:0,show:0}}},select:{top:[{value:1,label:"置顶"},{value:0,label:"不置顶"}],tags:[],group:[],comment:{allow:[{value:0,label:"继承父级（推荐）"},{value:1,label:"允许"},{value:2,label:"禁止"}],show:[{value:0,label:"继承父级（推荐）"},{value:1,label:"显示"},{value:2,label:"隐藏"}]},audit:[{value:0,label:"待审核"},{value:1,label:"通过"},{value:2,label:"不通过"}]},backup:{group:[]}});o((async()=>{document.querySelectorAll(".container-fluid").forEach((e=>{e.classList.remove("container-fluid"),e.classList.add("container-xxl")})),await Le.init(),Ce.item.menu.menuList.push({line:!0},...await i())}));const Le={init:async()=>{var e;let l=null==(e=Ae.params)?void 0:e.id;n.is.empty(l)||(Ce.item.id=parseInt(l),Ce.item.loading=!0),await Le.getGroup(),await Le.getTags(),n.is.empty(Ce.item.id)?await Le.getConfig():await Le.getArticle(Ce.item.id)},getConfig:async()=>{var e;const{code:l,data:a}=await r.get("/api/config/one",{key:"ARTICLE"});200===l&&(n.in.array(null==(e=null==a?void 0:a.json)?void 0:e.editor,["tinymce","vditor"])?Ce.struct.editor=a.json.editor:Ce.struct.editor="tinymce")},getArticle:async(e=null)=>{const{code:l,msg:a,data:t}=await r.get("/api/article/one",{id:e});if(200!==l)return await Ue.push({path:"/admin/article/write"}),c.error("已为您跳转到文章撰写页！",a);if(Ce.struct={...t,json:Object.assign({},t.json,Ce.struct.json)},n.is.empty(t.covers)||(Ce.item.cover.preview=t.covers.split(",").map((e=>({name:e.replace(/.*\//,""),url:e})))),!n.is.empty(t.group)){let e=t.group.split("|").filter((e=>!n.is.empty(e))).map((e=>parseInt(e)));Ce.item.group=Le.tree.parse(Ce.backup.group,e)}n.is.empty(t.tags)||(Ce.item.tags=t.tags.split("|").filter((e=>!n.is.empty(e))).map((e=>parseInt(e)))),n.is.empty(e)||(Ce.item.loading=!1)},getGroup:async()=>{const{code:e,data:l}=await r.get("/api/article-group/column",{field:"id,pid,name,avatar"});200===e&&(Ce.backup.group=l,Ce.select.group=Le.tree.stringify(l,0))},getTags:async()=>{const{code:e,data:l}=await r.get("/api/tags/column",{field:"id,name"});200===e&&(Ce.select.tags=l.map((e=>({value:e.id,label:e.name}))))},save:async()=>{var e,l,a,t,s;"vditor"===Ce.struct.editor&&(Ce.struct.content=ze.$refs.vditor.getValue());let o=(null==(t=null==(a=null==(l=null==(e=Ce.struct)?void 0:e.content)?void 0:l.replace(/<[^>]+>/g,""))?void 0:a.replace(/\n/g,""))?void 0:t.length)||0;switch(o){case 0:return c.warn("你这文章一个字都没写，糊弄谁呢？");case 1:return c.warn("真就只写一个字呗？");default:if(o<10)return c.warn("你这太水了，10个字都不到。")}if(n.is.empty(null==(s=Ce.struct)?void 0:s.title))return c.warn("你可能忘记写标题了");let i=Ce.item.cover.links.split("\n").filter((e=>!n.is.empty(e))),u=Ce.item.group.reduce(((e,l)=>e.concat(l)),[]);u=Array.from(new Set(u.filter((e=>e)))).sort(((e,l)=>e-l)),Ce.struct.covers=n.is.empty(i)?"":i.join(","),Ce.struct.tags=n.is.empty(Ce.item.tags)?"":`|${Ce.item.tags.join("|")}|`,Ce.struct.group=n.is.empty(u)?"":`|${u.join("|")}|`,"vditor"===Ce.struct.editor&&(Ce.struct.content=ze.$refs.vditor.getValue()),Ce.item.wait=!0;const{code:d,msg:m,data:p}=await r.post("/api/article/save",{...Ce.struct,json:JSON.stringify(Ce.struct.json)});if(Ce.item.wait=!1,200!==d)return c.error(m);c.success(m),Ce.item.id=p.id,Ce.struct.id=p.id,await Ue.push({path:"/admin/article/write/"+parseInt(p.id)})},tree:{stringify:(e=[],l=0)=>{const a=[];for(const t of e)if(t.pid===l){const l={value:t.id,label:t.name,children:[]};l.children=Le.tree.stringify(e,t.id),a.push(l)}return a},parse:(e,l)=>{let a=[];for(let t of e)if(l.includes(t.id))if(0===t.pid)a.push([t.id]);else for(let e=0;e<a.length;e++)if(a[e][a[e].length-1]===t.pid){a.push([...a[e],t.id]);break}return a}},cover:{remove:e=>{delete Ce.item.cover.preview[e.uid]},success:async(e,l,a)=>{const{code:t,msg:s}=e;if(200!==t)return c.error(s);for(let o=0;o<a.length;o++)if(a[o].response){const{data:e}=a[o].response;if(!(null==e?void 0:e.path))continue;a[o]={name:e.path.replace(/.*\//,""),url:e.path}}Ce.item.cover.preview=a},error:(e,l,a)=>{},change:e=>{Ce.item.cover.preview=e.split("\n").filter((e=>!n.is.empty(e))).map((e=>({name:e.replace(/.*\//,""),url:e})))}},headers:()=>{var e,l,a,t,s;let o={};n.is.empty(null==(l=null==(e=null==globalThis?void 0:globalThis.inis)?void 0:e.api)?void 0:l.key)||(o["i-api-key"]=null==(t=null==(a=null==globalThis?void 0:globalThis.inis)?void 0:a.api)?void 0:t.key);let i=(null==(s=null==globalThis?void 0:globalThis.inis)?void 0:s.token_name)||"INIS_LOGIN_TOKEN";if(n.has.cookie(i)){let e=n.get.cookie(i);n.is.empty(e)||(o.Authorization=e)}return o},empty:e=>n.is.empty(e),change:{tags:e=>{n.is.empty(e)||e.forEach((async(e,l)=>{if("string"==typeof e){const{code:a,msg:t,data:s}=await r.post("/api/tags/save",{name:e});if(200!==a)return c.error("添加标签失败："+t),Ce.item.tags.splice(l,1);Ce.item.tags[l]=s.id,Ce.select.tags.push({value:s.id,label:e})}}))}}};return u((()=>Ce.item.cover.preview),((e={})=>{Ce.item.cover.links=e.map((e=>e.url)).join("\n")+"\n"}),{deep:!0}),u((()=>Ce.item.cover.links),(e=>{e=null==e?void 0:e.replace(/[\s\n]/g,""),n.is.empty(e)&&(Ce.item.cover.links="")})),u((()=>{var e;return null==(e=Ae.params)?void 0:e.id}),(e=>{n.is.empty(e)||Le.init()})),document.addEventListener("contextmenu",(e=>{var l,a;e.preventDefault(),(null==(l=null==e?void 0:e.target)?void 0:l.closest("#tinymce"))||null==(a=ze.$refs["global-menu"])||a.show(e.x,e.y)})),d((()=>{document.querySelectorAll(".container-xxl").forEach((e=>{e.classList.remove("container-xxl"),e.classList.add("container-fluid")}))})),(e,l)=>{const a=m("el-button"),t=m("i-svg"),s=m("el-tooltip"),o=m("el-input"),i=m("el-option"),r=m("el-select"),c=m("el-collapse-item"),u=m("el-upload"),d=m("el-tab-pane"),z=m("el-tabs"),_e=m("el-cascader"),je=m("el-collapse"),ze=p("loading");return v(),g(j,null,[f("div",E,[f("div",R,[f("div",H,[f("div",$,[b((v(),g("div",M,[b(f("span",null,[y(I,{modelValue:h(Ce).struct.content,"onUpdate:modelValue":l[0]||(l[0]=e=>h(Ce).struct.content=e),id:"tinymce"},null,8,["modelValue"])],512),[[w,"tinymce"===h(Ce).struct.editor]]),b(f("span",null,[y(S,{ref:"vditor",modelValue:h(Ce).struct.content,"onUpdate:modelValue":l[1]||(l[1]=e=>h(Ce).struct.content=e),opts:{height:600}},null,8,["modelValue"])],512),[[w,"vditor"===h(Ce).struct.editor]])])),[[ze,h(n).is.empty(h(Ce).struct.editor)]]),f("div",N,[y(a,{onClick:l[2]||(l[2]=e=>Le.save()),loading:h(Ce).item.wait,type:"primary",plain:"",class:"float-end"},{default:V((()=>[A("保 存")])),_:1},8,["loading"])])])]),b((v(),g("div",O,[y(je,{accordion:"",modelValue:h(Ce).item.active,"onUpdate:modelValue":l[13]||(l[13]=e=>h(Ce).item.active=e)},{default:V((()=>[f("div",q,[f("div",G,[y(c,{name:"1"},{title:V((()=>[A(" 展示信息 ")])),default:V((()=>[f("div",J,[y(s,{content:"（必须）文章的标题",placement:"top"},{default:V((()=>[f("span",null,[y(t,{name:"hint",size:"14px"}),K])])),_:1}),y(o,{modelValue:h(Ce).struct.title,"onUpdate:modelValue":l[3]||(l[3]=e=>h(Ce).struct.title=e),placeholder:"文章标题"},null,8,["modelValue"])]),!0===Te.login.user.result.auth.all?(v(),g("div",B,[f("label",D,[y(s,{content:"审核状态",placement:"top"},{default:V((()=>[f("span",null,[y(t,{name:"hint",size:"14px"}),F])])),_:1})]),y(r,{modelValue:h(Ce).struct.audit,"onUpdate:modelValue":l[4]||(l[4]=e=>h(Ce).struct.audit=e),class:"d-block custom font-13",placeholder:"请选择"},{default:V((()=>[(v(!0),g(j,null,U(h(Ce).select.audit,(e=>(v(),x(i,{key:e.value,label:e.label,value:e.value},{default:V((()=>[f("span",P,T(e.label),1),f("small",W,T(e.value),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])):C("",!0),f("div",Q,[y(s,{content:"文章的摘要",placement:"top"},{default:V((()=>[f("span",null,[y(t,{name:"hint",size:"14px"}),X])])),_:1}),y(o,{modelValue:h(Ce).struct.abstract,"onUpdate:modelValue":l[5]||(l[5]=e=>h(Ce).struct.abstract=e),autosize:{minRows:3,maxRows:10},placeholder:"简单的描述一下您的文章",type:"textarea"},null,8,["modelValue"])])])),_:1})])]),f("div",Y,[f("div",Z,[y(c,{name:"2"},{title:V((()=>[A(" 封面图 ")])),default:V((()=>[y(z,{modelValue:h(Ce).item.tabs,"onUpdate:modelValue":l[7]||(l[7]=e=>h(Ce).item.tabs=e),stretch:!0},{default:V((()=>[y(d,{label:"预览",name:"preview"},{default:V((()=>[y(u,{class:"custom upload",action:"/api/file/upload",headers:Le.headers(),multiple:!0,"list-type":"picture","on-remove":Le.cover.remove,"on-success":Le.cover.success,"on-error":Le.cover.error,"file-list":h(Ce).item.cover.preview},{default:V((()=>[y(a,{type:"primary",class:"w-100"},{default:V((()=>[A("上 传")])),_:1})])),_:1},8,["headers","on-remove","on-success","on-error","file-list"])])),_:1}),y(d,{label:"外链",name:"links"},{default:V((()=>[y(o,{modelValue:h(Ce).item.cover.links,"onUpdate:modelValue":l[6]||(l[6]=e=>h(Ce).item.cover.links=e),onChange:Le.cover.change,wrap:"off",autosize:{minRows:3,maxRows:10},placeholder:"外链图片地址，一行一个",type:"textarea"},null,8,["modelValue","onChange"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])]),f("div",ee,[f("div",le,[y(c,{name:"3"},{title:V((()=>[A(" 置顶、分类、标签 ")])),default:V((()=>[f("div",ae,[f("label",te,[y(s,{content:"可同时选择多个分类",placement:"top"},{default:V((()=>[f("span",null,[y(t,{name:"hint",size:"14px"}),se])])),_:1})]),y(r,{modelValue:h(Ce).struct.top,"onUpdate:modelValue":l[8]||(l[8]=e=>h(Ce).struct.top=e),class:"d-block custom",placeholder:"请选择",filterable:""},{default:V((()=>[(v(!0),g(j,null,U(h(Ce).select.top,(e=>(v(),x(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),f("div",oe,[f("label",ie,[y(s,{content:"可同时选择多个分类",placement:"top"},{default:V((()=>[f("span",null,[y(t,{name:"hint",size:"14px"}),ne])])),_:1})]),y(_e,{options:h(Ce).select.group,props:{multiple:!0,checkStrictly:!0},modelValue:h(Ce).item.group,"onUpdate:modelValue":l[9]||(l[9]=e=>h(Ce).item.group=e),"collapse-tags":"",clearable:"",filterable:"",class:"w-100"},null,8,["options","modelValue"])]),f("div",re,[f("label",ce,[y(s,{content:"可同时选择多个标签",placement:"top"},{default:V((()=>[f("span",null,[y(t,{name:"hint",size:"14px"}),ue])])),_:1})]),y(r,{modelValue:h(Ce).item.tags,"onUpdate:modelValue":l[10]||(l[10]=e=>h(Ce).item.tags=e),onChange:Le.change.tags,multiple:"","collapse-tags":"",filterable:"","allow-create":"","default-first-option":"",class:"d-block custom",placeholder:"请选择"},{default:V((()=>[(v(!0),g(j,null,U(h(Ce).select.tags,(e=>(v(),x(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])])),_:1})])]),f("div",de,[f("div",me,[y(c,{name:"4"},{title:V((()=>[A(" 高级选项 ")])),default:V((()=>[f("div",pe,[f("label",ve,[y(s,{content:"对当前文章的评论选项单独控制",placement:"top"},{default:V((()=>[f("span",null,[y(t,{name:"hint",size:"14px"}),ge])])),_:1})]),y(r,{modelValue:h(Ce).struct.json.comment.allow,"onUpdate:modelValue":l[11]||(l[11]=e=>h(Ce).struct.json.comment.allow=e),class:"d-block custom font-13",placeholder:"请选择"},{default:V((()=>[(v(!0),g(j,null,U(h(Ce).select.comment.allow,(e=>(v(),x(i,{key:e.value,label:e.label,value:e.value},{default:V((()=>[f("span",fe,T(e.label),1),f("small",be,T(e.value),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])]),f("div",he,[f("label",ye,[y(s,{content:"对当前文章的评论选项单独控制",placement:"top"},{default:V((()=>[f("span",null,[y(t,{name:"hint",size:"14px"}),we])])),_:1})]),y(r,{modelValue:h(Ce).struct.json.comment.show,"onUpdate:modelValue":l[12]||(l[12]=e=>h(Ce).struct.json.comment.show=e),class:"d-block custom font-13",placeholder:"请选择"},{default:V((()=>[(v(!0),g(j,null,U(h(Ce).select.comment.show,(e=>(v(),x(i,{key:e.value,label:e.label,value:e.value},{default:V((()=>[f("span",Ve,T(e.label),1),f("small",xe,T(e.value),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])])),_:1})])])])),_:1},8,["modelValue"])])),[[ze,h(Ce).item.loading]])])]),(v(),x(k,{to:"body"},[f("div",ke,[y(s,{content:"保存文章",placement:"top"},{default:V((()=>[y(a,{onClick:l[14]||(l[14]=e=>Le.save()),loading:h(Ce).item.wait,class:"btn btn-auto mimic ms-0"},{default:V((()=>[h(Ce).item.wait?C("",!0):(v(),x(t,{key:0,name:"save",size:"1.2em"}))])),_:1},8,["loading"])])),_:1})])])),y(h(L),_({ref:"global-menu"},h(Ce).item.menu),null,16)],64)}}};export{_e as default};
