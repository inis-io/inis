import{r as s,h as a,p as t,m as l,i as e,a as n,B as o,o as i,c,C as u,e as d,b as r,d as p,w as m,f as g,F as f}from"./1690460619.index.js";const b={class:"card"},v={class:"card-body"},h={class:"text-muted text-uppercase mt-0"},x=r("strong",{class:"text-success"},"开启后满足条件的客户端IP会被自动拉黑！",-1),w=r("br",null,null,-1),S=r("br",null,null,-1),_=r("br",null,null,-1),P=r("br",null,null,-1),y=r("br",null,null,-1),V={class:"d-inline-flex align-items-center"},C=r("span",{class:"ms-1"},"自动 IP 黑名单",-1),j={class:"m-b-20"},k=r("span",{class:"badge bg-primary font-white"}," +30% ",-1),I={class:"text-muted ms-1"},Q=r("strong",{class:"flex-center"},"配置",-1),O={class:"row"},z={class:"col-md-6"},B={class:"form-group mb-3"},U={class:"form-label"},E=r("span",{class:"ms-1"},"触发次数：",-1),K={class:"col-md-6"},L={class:"form-group mb-3"},M={class:"form-label"},T=r("span",{class:"ms-1"},"时间频率（秒）：",-1),Y={__name:"qps-black",setup(Y,{expose:D}){const q=s({struct:{value:0,json:{count:null,second:""}},status:{finish:!1,active:!1,dialog:!1,loading:!0,wait:!1}});a((async()=>{await A.init()}));const A={init:async()=>{q.status.finish=!1,q.status.loading=!0;const{code:s,data:a}=await t.get("/api/config/one",{key:"SYSTEM_QPS_BLOCK"});q.status.loading=!1,200===s&&(q.struct=a,q.status.finish=!0)},show(){if(!q.status.finish)return l.warn("配置获取失败，无法进行配置！");q.status.dialog=!0},change:async s=>{const{code:a,msg:e}=await t.post("/api/config/save",{key:"SYSTEM_QPS_BLOCK",value:s?1:0});200!==a&&(q.status.active=!s,l.error(e))},save:async()=>{q.status.wait=!0;const{code:s,msg:a}=await t.post("/api/config/save",{key:"SYSTEM_QPS_BLOCK",json:JSON.stringify(q.struct.json)});if(q.status.wait=!1,200!==s)return l.error("保存失败："+a);q.status.dialog=!1}};return e((()=>q.struct),(()=>{q.status.active=1===parseInt(q.struct.value),q.struct.expire=q.struct.json.second.replace(/[^\d\s*+\-\/]/g,"")}),{deep:!0}),D({init:A.init}),(s,a)=>{const t=n("i-svg"),l=n("el-tooltip"),e=n("el-switch"),Y=n("el-input-number"),D=n("el-input"),F=n("el-button"),J=n("el-dialog"),N=o("load");return i(),c(f,null,[u((i(),c("div",b,[r("div",v,[p(t,{name:"black",size:"58px",color:"rgb(var(--assist-color))",class:"position-absolute opacity-25",style:{right:"1.5rem"}}),r("h6",h,[p(l,{placement:"top"},{content:m((()=>[x,w,g(" ● 此功能需要搭配 QPS 使用，在 时间频率 内，达到 触发 QPS 次数上限，自动拉黑对应的客户端IP"),S,g(" ● 如：在1小时内，某客户端IP触发了3次 QPS 警告，则自动拉黑此客户端IP，并且后续无法访问任何API"),_,g(" ● 此功能可以有效防止恶意攻击，如：CC攻击、DDOS攻击等"),P,g(" ● 需要注意的是，随机图片接口也会受到影响"),y])),default:m((()=>[r("span",V,[p(t,{name:"hint",color:"rgb(var(--icon-color))",size:"14px"}),C])])),_:1})]),r("h2",j,[p(e,{modelValue:d(q).status.active,"onUpdate:modelValue":a[0]||(a[0]=s=>d(q).status.active=s),onChange:A.change,disabled:!d(q).status.finish,"active-text":"我怂","inactive-text":"无所畏惧"},null,8,["modelValue","onChange","disabled"])]),k,r("span",I,[g(" 安全性提升，"),r("span",{onClick:a[1]||(a[1]=s=>A.show()),class:"text-white pointer"},"点我配置")])])])),[[N,[d(q).status.loading,null,null]]]),p(J,{modelValue:d(q).status.dialog,"onUpdate:modelValue":a[6]||(a[6]=s=>d(q).status.dialog=s),class:"custom",draggable:"","close-on-click-modal":!1},{header:m((()=>[Q])),default:m((()=>[r("div",O,[r("div",z,[r("div",B,[r("label",U,[p(l,{content:"触发QPS的次数，推荐：3",placement:"top"},{default:m((()=>[r("span",null,[p(t,{name:"hint",size:"14px"}),E])])),_:1})]),p(Y,{modelValue:d(q).struct.json.count,"onUpdate:modelValue":a[2]||(a[2]=s=>d(q).struct.json.count=s),min:1,class:"w-100 d-flex"},null,8,["modelValue"])])]),r("div",K,[r("div",L,[r("label",M,[p(l,{content:"可以用乘法，如：60 * 60 表示1小时",placement:"top"},{default:m((()=>[r("span",null,[p(t,{name:"hint",size:"14px"}),T])])),_:1})]),p(D,{modelValue:d(q).struct.json.second,"onUpdate:modelValue":a[3]||(a[3]=s=>d(q).struct.json.second=s)},null,8,["modelValue"])])])])])),footer:m((()=>[p(F,{onClick:a[4]||(a[4]=s=>d(q).status.dialog=!1)},{default:m((()=>[g("取 消")])),_:1}),p(F,{onClick:a[5]||(a[5]=s=>A.save()),loading:d(q).status.wait},{default:m((()=>[g("保 存")])),_:1},8,["loading"])])),_:1},8,["modelValue"])],64)}}};export{Y as _};
